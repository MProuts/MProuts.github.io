
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Full Stack Snacks</title>
  <meta name="author" content="Michael Prouty">

  
  <meta name="description" content="The Basics TCP/IP (or Transmission Control Protocol/Internet Protocol) is the most ubiquetous inter-network protocol in use today. Computers use
TCP/ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://MProuts.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Full Stack Snacks" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-50683410-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Full Stack Snacks</a></h1>
  
    <h2>One byte at a time.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:MProuts.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/15/addressing-ip/">Addressing IP</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-15T11:44:20-04:00" pubdate data-updated="true">Jul 15<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>The Basics</h3>

<p>TCP/IP (or Transmission Control Protocol/Internet Protocol) is the most ubiquetous inter-network protocol in use today.  Computers use
TCP/IP to connect to other networks as well as to the internet.  An IP
address is a unique identifier for a device connected to a TCP/IP
network.</p>

<p>IP addresses consists of four eight-digit binary numbers or <em>octets</em>
(also called <em>bytes</em>), usually represented in base-10 notation, and
separated by periods.</p>

<h4>Example Binary Representation</h4>

<blockquote><p>1100000 10101000 00000001 00110110</p></blockquote>

<h4>Example Base-10 Representation</h4>

<blockquote><p>192.168.1.54</p></blockquote>

<h3>Reserved Addresses</h3>

<p>Some addresses are reserved for particular purposes.  A list follows:</p>

<p><strong>0.0.0.0</strong> is reserved for the <strong>Default Route</strong>, meaning that address
lookups that do not match any route known to the network fall back to
this address.  It typically points to the default gateway &mdash; the node on
the network (often your router) that serves as the point of access for connecting to
other networks or the internet.</p>

<p><strong>255.255.255.255</strong> is reserved for <strong>Network Broadcasts</strong>.  Messages
sent to this address go to all computers on the network.</p>

<p><strong>127.0.0.1</strong> is the most commonly-used <strong>Loopback Address</strong>, which is
an address your computer uses to refer to itself.  Messages sent from your computer to this address echo back to your computer.  The hostname &lsquo;localhost&rsquo; resolves to this address.</p>

<h3>Private IP Addresses</h3>

<p>The TCP/IP protocol was devised in the 1970s before the internet took
off.  The specification for IPv4 addresses (as opposed to the newer
<a href="http://en.wikipedia.org/wiki/IPv6">IPv6</a>) only provides for <code>256 ^ 4</code> or
<code>4,294,967,296</code> unique addresses.  If every internet-enabled device was
assigned a unique address, the pool of unique addresses would have been
exhausted long ago.</p>

<p>Realizing this, back in 1996, the Internet Engineering Task Force (IETF)
specified special blocks of <em>private IP addresses</em> &mdash; i.e. addresses that
could not be used over the internet.  This way, groups of internet-enabled
devices could share a single globally-unique public IP address through a
router, while maintaining separate private IP addresses to communicate
amoungst themselves on a local network.  The uniqueness of a private IP address
is only enforced amoung devices on a given local network, thus many devices
can simultaneously use the same local IP address on separate local networks.</p>

<p>Reserved private IP address ranges are as follows:</p>

<table>
<tr>
  <th style="font-size:.8em">Class</th>
  <th style="font-size:.8em">Address Range</th>
  <th style="font-size:.8em">Leading Bits</th>
  <th style="font-size:.8em">CIDR Notation</th>
  <th style="font-size:.8em">Unique Addresses</th>
</tr>
<tr>
  <td>A</td>
  <td>10.0.0.0 - 10.225.225.225</td>
  <td>00001010</td>
  <td>10.0.0.0/8</td>
  <td style="text-align:right">16,777,216</td>
</tr>
<tr>
  <td>B</td>
  <td>172.16.0.0 - 172.31.255.255</td>
  <td>10101100 0001</td>
  <td>172.16.0.0/12</td>
  <td style="text-align:right">1,048,576</td>
</tr>
<tr>
  <td>C</td>
  <td>192.168.0.0 - 192.168.255.255</td>
  <td>11000000 10101000</td>
  <td>192.168.0.0/16</td>
  <td style="text-align:right">65,536</td>
</tr>
</table>


<br>


<p>Since the number of computers connected to a LAN is typically much
smaller than 65,536, most routers limit their IP assignments to 255
addresses in the range 192.168.0.1 &ndash; 192.168.0.255.</p>

<p>If you check your private IP address under network preferences (assuming you&rsquo;re
on a Mac), it is probably in the form &lsquo;192.168.0.X.&rsquo;</p>

<h3>Public IP Addresses</h3>

<p>If you google
<a href="https://www.google.com/search?q=what+is+my+ip+address">&lsquo;what is my ip address&rsquo;</a>,
you will quickly find your router&rsquo;s public IP address.  This will be the same for
every device connected to your LAN.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/20/check-for-stray-binding-dot-prys-before-commit/">Check for Stray Pry Calls Before Commit</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-20T22:59:36-04:00" pubdate data-updated="true">Jun 20<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Tired of accidentally checking <code>binding.pry</code> calls into source?  Here&rsquo;s a
script that will take care of checking for them on your behalf.  Place
this in your project&rsquo;s <code>.git/hooks</code> directory in a file called <code>pre-commit</code>.</p>

<h3>.git/hooks/pre-commit</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'>
</span><span class='line'>git diff --cached --name-only | <span class="se">\</span>
</span><span class='line'>    <span class="nv">GREP_COLOR</span><span class="o">=</span><span class="s1">&#39;4;5;37;41&#39;</span> xargs grep --color --with-filename -n pry <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s1">&#39;COMMIT REJECTED&#39;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure>


<p><em>Note</em>: Don&rsquo;t forget to <code>chmod pre-commit u+x</code> to make this file
executable.</p>

<p>Let&rsquo;s step through this script line by line.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/sh</span>
</span></code></pre></td></tr></table></div></figure>


<p>First, we use a shebang directive
to specify the interpreter that will be used to run the code in this file.  Since
we&rsquo;re writing a shell script we specify <code>/bin/sh</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git diff --cached --name-only | <span class="se">\</span>
</span></code></pre></td></tr></table></div></figure>


<p> <code>git diff</code> shows us any differences between the code in working directory
and our previous commit.  We pass it the <code>--cached</code> flag to show
changes to files that have already been staged.  The <code>--name-only</code> flag will
print just the names of files that have been changed, rather than the
actual changed contents of those files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">GREP_COLOR</span><span class="o">=</span><span class="s1">&#39;4;5;37;41&#39;</span> xargs grep --color --with-filename -n pry <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span></code></pre></td></tr></table></div></figure>


<p> <code>GREP_COLOR</code> is an environment variable that determines the colors
 <code>grep</code> uses to highlight matches when the <code>--color</code> flag is given.  We
use <code>xargs</code> to feed the individual file names that resulted from the previous line to <code>grep pry</code>.  The <code>--with-filename</code> and <code>-n</code> flags add the
file name and line number to the results, respectively.   We use the
logical operator <code>&amp;&amp;</code> to execute the next line of code only if the
current line runs successfully.  (I.e. If <code>grep</code> doesn&rsquo;t find any
occurances of &lsquo;pry&rsquo;, the chain stops here.)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">echo</span> <span class="s1">&#39;COMMIT REJECTED&#39;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'><span class="nb">exit </span>1
</span></code></pre></td></tr></table></div></figure>


<p>If grep does find a &lsquo;pry&rsquo; anywhere in our staged changes, we print an error message and exit with a status
of <code>1</code> for &lsquo;error&rsquo;, which tells <code>git</code> to terminate the commit.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure>


<p>Otherwise, we exit with a status of <code>0</code> for &lsquo;successful&rsquo;, which tells <code>git</code> to go ahead with the commit.</p>

<h3>Make This Hook Global</h3>

<p>To make this hook global, run the following command and copy the script
into <code>~/.git_template/hooks</code>.  Thereafter, every time you call <code>git init</code>, it will be included in your project&rsquo;s <code>.git/hooks</code> directory.</p>

<pre><code>$ git config --global init.templatedir '~/.git_template'

$ cp /myproject/.git/hooks/pre-commit ~/.git_template/hooks/pre-commit
</code></pre>

<p>And there you have it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/01/cross-domain-post-and-delete-with-jquery-and-rails/">Cross-Domain Requests With Angular & Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-01T09:54:29-04:00" pubdate data-updated="true">Jun 1<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Most modern web APIs provide programatic access to an application&rsquo;s internals by exposing RESTful JSON endpoints.  For example, a <code>POST</code> to <code>/pokemon.json</code> with a lump of properly-formatted JSON might create a new pokemon resource on the application server.</p>

<p>Javascript frameworks like Angular were designed to
sit on top of APIs, accessing data through endpoints like
the one described above. When an Angular app and the API it consumes are
hosted on separate domains, data access is complicated by a security restriction implemented by most browsers called the <code>same-origin policy</code>.  Under the <code>same-origin policy</code>, client-side scripts running in one domain are prevented from obtaining data retrieved from another domain.</p>

<p>Luckily, most browsers also provide a mechanism for getting
around this restriction called <code>cross-origin resource sharing</code>, or <code>CORS</code>.  Here&rsquo;s
what you need to know to get it working with jQuery and Rails.</p>

<h1>GET</h1>

<p>Let&rsquo;s say that you have your Angular app running in development on port 8000,
and your Rails API running on port 3000. When your Angular app loads, it will probably need to request some data
from the server.</p>

<h3>app.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$http</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000/pokemon.json&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">pokedex</span><span class="p">.</span><span class="nx">pokemons</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>But this produces an error.</p>

<p><img src="/images/cors_get_request.png"></p>

<p>Under the <code>same-origin policy</code>, the browser will block cross-domain <code>XMLHttpRequests</code> unless the server&rsquo;s response to such requests includes an <code>access-control-allow-origin</code> header that matches the
requesting script&rsquo;s <code>origin</code> (In our case, <code>http://localhost:8000</code>).</p>

<p>In Rails, we can simply add this header to all responses
in our application controller as follows.</p>

<h3>application_controller.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">before_filter</span> <span class="ss">:set_access_control_headers</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">set_access_control_headers</span>
</span><span class='line'>  <span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:8000&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>POST</h1>

<p> <code>POST</code> should now also work.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/pokemon/&#39;</span> <span class="o">+</span> <span class="nx">pokemon</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;/comments&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">data</span><span class="o">:</span> <span class="nx">mydata</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h1>DELETE</h1>

<p> <code>GET</code> and <code>POST</code> are considered <em>simple requests</em> under the
 <code>CORS</code> standard, meaning that providing the access control headers is
 sufficient for cross-domain requests.</p>

<p>But what about <code>DELETE</code>?</p>

<h3>app.js</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:3000/pokemon/&#39;</span> <span class="o">+</span> <span class="nx">pokemon</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;/comments/&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">contentType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;produces&hellip;</p>

<p><img src="/images/cors_delete_request.png"></p>

<p>&hellip;and in the Rails log&hellip;</p>

<pre><code>Started OPTIONS "/pokemon/11/comments/119" for 127.0.0.1 at 2014-06-01 11:38:14 -0400

ActionController::RoutingError (No route matches [OPTIONS] "/pokemon/11/comments/119"):
</code></pre>

<h1>Preflighted Requests</h1>

<p>Under <code>CORS</code>, requests using methods other than <code>GET</code> or <code>POST</code> need to be <em>preflighted</em>.  Essentially, before the
actual request can take place, the client sends a preliminary
 <code>OPTIONS</code> request with an <code>access-control-request-method</code>
header, asking permission to use a particular HTTP method with a given URL.  In our case, we
want to use <code>DELETE</code> at <code>/pokemon/11/comments/119</code>.  jQuery is smart enough to initiate the preflight
request for us&hellip;</p>

<pre><code>OPTIONS /pokemon/11/comments/119
Origin: http://localhost:8000
Access-Control-Request-Method: DELETE
</code></pre>

<p>&hellip;so if the server responds with&hellip;</p>

<pre><code>Access-Control-Allow-Origin: http://localhost:8000
Access-Control-Allow-Methods: DELETE
</code></pre>

<p>&hellip;then the browser will allow the original request to go through.</p>

<p>Rather than roll our own system for handling this exchange,
we can simply add the <code>rack-cors</code> gem to our gemfile.</p>

<h3>Gemfile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rack-cors&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s1">&#39;rack/cors&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>config/application.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">use</span> <span class="ss">Rack</span><span class="p">:</span><span class="ss">:Cors</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">allow</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">origins</span> <span class="s1">&#39;http://localhost:8000&#39;</span>
</span><span class='line'>    <span class="n">resource</span> <span class="sr">%r{/pokemon/\d+/comments/\d+}</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;Accept&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:methods</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:delete</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As configured above, <code>rack-cors</code> will intercept the preflight <code>OPTIONS</code> request from jQuery and grant <code>DELETE</code> access to <code>localhost:8000</code>.</p>

<p>And there you have it.  :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/18/hello-bower/">Hello, Bower</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-18T11:05:16-04:00" pubdate data-updated="true">May 18<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Bower is a simple package manager for front-end assets like CSS and
Javascript. It provides an elegant solution for including third-party assets and libraries (e.g.
Bootstrap, jQuery) into different projects on your machine.  Here&rsquo;s how it
works:</p>

<h3>Get Bower</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm install -g bower</span></code></pre></td></tr></table></div></figure>


<h3>Install a Package</h3>

<p>Bower installs packages on a project-by-project basis.  Make sure
you&rsquo;re inside of the project directory where you want a package installed first,
then run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ bower install &lt;package&gt;</span></code></pre></td></tr></table></div></figure>


<p>This command creates a directory inside your project called <code>bower-components/</code>
containing the package you&rsquo;ve installed, as well as any dependencies.</p>

<h3>Use a Package</h3>

<p>To use a Bower package, simply reference the appropriate files in <code>bower-components/</code> manually.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script src="/bower_components/jquery/jquery.js"&gt;&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<h3>List Packages</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ bower list</span></code></pre></td></tr></table></div></figure>


<p>Use this command to list all packages installed on a given project.  Again, the list of
installed packages will vary on a project-by-project basis.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/04/how-to-use-homebrews-version-of-git/">How to Use Homebrew&#8217;s Version of Git</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-04T15:20:02-04:00" pubdate data-updated="true">May 4<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you’re using Homebrew with OSX, chances are you have multiple copies of the same software packages living on your machine. With this in mind, it&rsquo;s important to know which version of a particular package gets run when you type a command at the command line.  For example, when you type <code>git status</code>, are you running OSX&rsquo;s version of git or Homebrew&rsquo;s version?</p>

<p>Here&rsquo;s the scoop:</p>

<h3>OSX Packages</h3>

<p>OSX’s binaries live in <code>/usr/bin</code>.  They are the defaults that either came
preinstalled in your machine, or were bundled with Xcode.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls /usr/bin</span></code></pre></td></tr></table></div></figure>


<h3>Homebrew Packages</h3>

<p>Under the covers, Homebrew installs packages or ‘kegs’ in their own directories in <code>/usr/local/Cellar</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls /usr/local/Cellar</span></code></pre></td></tr></table></div></figure>


<p>For convenience, Homebrew symlinks binaries nested within these directories to <code>/usr/local/bin</code>.  These links are how you access and run Homebrew binaries.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls /usr/local/bin</span></code></pre></td></tr></table></div></figure>


<h3>Which Package?</h3>

<p>Which of these two versions gets run is determined by your PATH variable.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ which git
</span><span class='line'>/usr/bin/git</span></code></pre></td></tr></table></div></figure>


<p>If you take a look at your global PATH configuration by running <code>cat etc/paths</code> you&rsquo;ll see that binaries in <code>/usr/bin</code> are
run before binaries in <code>/usr/local/bin</code> by default.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat etc/paths
</span><span class='line'>/usr/bin
</span><span class='line'>/bin
</span><span class='line'>/usr/sbin
</span><span class='line'>/sbin
</span><span class='line'>/usr/local/bin</span></code></pre></td></tr></table></div></figure>


<p>You can move Homebrew&rsquo;s binaries to the front of the line by adding this
to your preferred shell&rsquo;s resource file (<code>bashrc</code> or <code>zshrc</code>).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export PATH=/usr/local/bin:$PATH</span></code></pre></td></tr></table></div></figure>


<p>Voila!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ which git 
</span><span class='line'>/usr/local/bin/git</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/02/psql-cheatsheet/">Psql Cheatsheet</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-02T15:48:12-04:00" pubdate data-updated="true">May 2<span>nd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Django development requires that you know your way around your database
console.  Here are the basics for PostgreSQL:</p>

<h3>start</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>psql            #Start interactive terminal</span></code></pre></td></tr></table></div></figure>


<h3>database</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\list                    #List databases
</span><span class='line'>\connect &lt;db&gt;            #Switch connection
</span><span class='line'>
</span><span class='line'>SELECT 
</span><span class='line'>current_database();      #Show database connection</span></code></pre></td></tr></table></div></figure>


<h3>tables</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\d              #List tables
</span><span class='line'>\d &lt;table&gt;      #List table columns</span></code></pre></td></tr></table></div></figure>


<h3>help</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\?              #List backslash commands
</span><span class='line'>\help           #List SQL commands</span></code></pre></td></tr></table></div></figure>


<h3>quit</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\q              #Quit  </span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/01/star-register-not-working-in-vim/">Star Register Not Working in Vim?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-01T13:19:04-04:00" pubdate data-updated="true">May 1<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The star register provides a convenient way to read and write from the system clipboard in vim.  (For example: <code>"*yy</code> in vim, <code>ctrl-v</code> in another application.)</p>

<p>For this to work, you need a version of vim
compiled with the <code>clipboard</code> feature included.  You can easily check
the features included in your vim version by running:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim --version
</span><span class='line'>...
</span><span class='line'>-clipboard       +iconv           +path_extra      -toolbar
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>If you see <code>+clipboard</code>, you&rsquo;re in good shape.</p>

<p>Elsif you see <code>-clipboard</code>, read on for the fix.</p>

<p>1) Get the latest version of vim.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install vim</span></code></pre></td></tr></table></div></figure>


<p>2) Check which local version of vim is being used.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>which vim
</span><span class='line'>/usr/bin/vim</span></code></pre></td></tr></table></div></figure>


<p>3) If you don&rsquo;t see <code>/usr/local/bin/vim</code>,
add the following lines to <code>~/.bashrc</code> or <code>~/.zshrc</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Prefer Homebrew binaries
</span><span class='line'>export PATH=/usr/local/bin:$PATH</span></code></pre></td></tr></table></div></figure>


<p>4) Run <code>vim --version</code> again to make sure it worked.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim --version 
</span><span class='line'>...
</span><span class='line'>+clipboard       +iconv           +path_extra      -toolbar
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>Success!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/06/friendly-forwarding-with-devise/">Friendly Forwarding With Devise</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-06T17:10:43-04:00" pubdate data-updated="true">Apr 6<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s pretty common to require that a user be logged in to perform certain
actions around your application. For example, let&rsquo;s say you wanted to make sure a user
was
signed in before being able to see any user&rsquo;s profile. Assuming you&rsquo;re using Devise for
authentication, your code might look something like this:</p>

<h3>controllers/users_controller.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:set_user</span><span class="p">,</span> <span class="ss">:only</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:show</span><span class="o">]</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:require_login</span><span class="p">,</span> <span class="ss">:only</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:show</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">set_user</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">require_login</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="n">new_user_session_path</span><span class="p">,</span> <span class="ss">:notice</span> <span class="o">=&gt;</span> <span class="s2">&quot;Please sign in.&quot;</span>  <span class="k">unless</span> <span class="n">user_signed_in?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, our before action, <code>require_login</code>, conditionally redirects to the login page if a request hits the <code>user#show</code> action and no user is signed in.
Note that we make use of Devise&rsquo;s handy <code>user_signed_in?</code> method to make this happen.</p>

<p>Cool.</p>

<h1>Now what?</h1>

<p>But what will the user see after they log in?  In other words:</p>

<p>If I&hellip;</p>

<p>   1) browse to a restricted page,<br/>
   2) get redirected to login page,<br/>
   3) sign in,<br/>
   4) ???</p>

<p>&hellip;then where do I go next?</p>

<p>Out of the box, Devise redirects to the <code>root_url</code> upon successfully signing in a
user.  In certain cases, this may make sense from the perspective of the
user.  However, in the case outlined above, redirecting to the <code>root_url</code> breaks
the deal our application struck with the user in step 2.</p>

<p>Here are the same four lines in plain English:</p>

<p>1) User: &ldquo;Hey application, show me this thing.&#8221;<br/>
2) Application: &#8220;Hey user, I will, as long as you log in first.&#8221;<br/>
3) User: &#8220;Totes, np!&rdquo; &lt;logs in cheerfully> <br/>
4) Application: &ldquo;Here&rsquo;s the homepage, what can I help you with?&rdquo;</p>

<p>Absurd, I say.  Absurd.</p>

<h1>Forward!</h1>

<p>So we need to make our application less rude by giving it a tiny bit of short-term
memory, but how can we accomplish this in a stateless protocol like HTTP?</p>

<p>Answer: Sessions.</p>

<p>A session (or &ldquo;user session&rdquo;) is a mechanism for persisting bits of
user-specific data across multiple HTTP request cycles, giving the illusion that
an application <em>maintains state</em>, or remembers things about its past interactions with a particular user.</p>

<p>How exactly sessions are implemented is beyond the scope of this post, but for now, we&rsquo;ll content ourselves with the fact
that we can stick information into a hash-like variable called <code>session</code> in our
controllers, and then retreive it when handling subsequent requests.</p>

<p>Back to our example.  In order to keep track of which page the user was asking
for
when we told them to sign in, we can jot down a reminder for ourselves in the <code>session</code>.</p>

<h3>controllers/users_controller.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">private</span>
</span><span class='line'><span class="k">def</span> <span class="nf">require_login</span>
</span><span class='line'>  <span class="k">unless</span> <span class="n">user_signed_in?</span>
</span><span class='line'>    <span class="n">session</span><span class="o">[</span><span class="ss">:forward_url</span><span class="o">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">fullpath</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="n">new_user_session_path</span><span class="p">,</span> <span class="ss">:notice</span> <span class="o">=&gt;</span> <span class="s2">&quot;Please sign in.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>That way, instead of trying to remember our entire conversation, (which is, well, impossible),
we simply check the session for reminders
everytime we log a user in.</p>

<h3>controllers/application_controller.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">after_sign_in_path_for</span> <span class="n">user</span>
</span><span class='line'>    <span class="n">session</span><span class="o">[</span><span class="ss">:forward_url</span><span class="o">]</span> <span class="p">?</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:forward_url</span><span class="p">)</span> <span class="p">:</span> <span class="k">super</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Devise calls a method aptly name <code>after_sign_in_path_for</code> to determine where to send the client after login.
This method is implemented internally in Devise, but we can override it by <em>duck
punching</em> it in our <code>ApplicationController</code>.</p>

<p>Our implentation checks for a reminder in the session, deletes and returns that
reminder if
it exists, and otherwise passes the call up the inheritance tree to Devise&rsquo;s
default <code>after_sign_in_path_for</code> method.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/25/rails-testing-with-factorygirl-and-faker/">Testing With FactoryGirl and Faker</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-25T19:57:39-04:00" pubdate data-updated="true">Mar 25<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the context of Rails development, fixtures provide an easy way to create sample data and
make it available to your tests. Every time Rails generates a model, it
also creates a corresponding .yml in <code>test/fixtures</code> for your fixture code.</p>

<h3>test/fixtures/users.yml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>meryl:
</span><span class='line'>  name: Meryl Streep
</span><span class='line'>  birthday: 1949-06-22
</span><span class='line'>  occupation: Actress</span></code></pre></td></tr></table></div></figure>


<p>You can access fixtures in your tests as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">users</span><span class="p">(</span><span class="ss">:meryl</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>While fixtures let you weave elaborate narratives involving Meryl Streep&rsquo;s interactions with your site, they tend not to be very
DRY.  For example, if you want access to 12 pre-defined instances of <code>User</code> in your specs, you need to define 12 fixures in your
<strong>users.yml</strong> file.  This process can be cumbersome and error-prone.</p>

<h1>Factory Girl</h1>

<p>There&rsquo;s a gem for that.</p>

<h3>Gemfile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;factory_girl_rails&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Factory Girl is Thoughtbot&rsquo;s solution to this problem, and it is awesome.  Rather than hardcode your fixture data, Factory Girl lets you define factories &mdash; methods that dynamically generate objects &mdash; using a friendly DSL.</p>

<h3>spec/factories.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s2">&quot;Meryl Streep&quot;</span>
</span><span class='line'>    <span class="n">birthday</span> <span class="s2">&quot;1949-06-22&quot;</span>
</span><span class='line'>    <span class="n">occupation</span> <span class="s2">&quot;Actress&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>It then exposes methods for assembling users from said factories in your tests.</p>

<h3>spec/models/users.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">build</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; unpersisted version of Meryl</span>
</span><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; persisted version of Meryl (separate object)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Sequences</h1>

<p>Let&rsquo;s say your user model validates uniqueness on its
&lsquo;name&rsquo; attribute, and you need to create 20 valid users in
your tests (each with a unique name).  Two &lsquo;Meryl Streep&rsquo; s will no longer fly.</p>

<p>Luckily, Factory Girl provides a build-in fix in the form of sequences.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">sequence</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">&quot;Meryl Streep</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">birthday</span> <span class="s2">&quot;1949-06-22&quot;</span>
</span><span class='line'>  <span class="n">occupation</span> <span class="s2">&quot;Actress&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then&hellip;</p>

<h3>spec/models/users.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'><span class="c1">#=&gt; &quot;Meryl Streep1&quot;</span>
</span><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'><span class="c1">#=&gt; &quot;Meryl Streep2&quot;</span>
</span><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'><span class="c1">#=&gt; &quot;Meryl Streep3&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Strange example, but you get the picture.</p>

<h1>Faker</h1>

<p>Given that (possibly) not everyone loves Meryl Streep as much as I do,
wouldn&rsquo;t it be nice if our factory could dynamically generate unique, natural-sounding
names for each user it created?</p>

<p>There&rsquo;s a gem for that.</p>

<h3>gemfile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;faker&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>spec/factories</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="ss">Faker</span><span class="p">:</span><span class="ss">:Name</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>  <span class="n">birthday</span> <span class="s2">&quot;1949-06-22&quot;</span>
</span><span class='line'>  <span class="n">occupation</span> <span class="s2">&quot;Actress&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>spec/users_spec.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'><span class="c1">#=&gt; &quot;Anastacio Jast&quot;</span>
</span><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'><span class="c1">#=&gt; &quot;Edna Weimann&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Faker can fake out lots of other things as well:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Faker</span><span class="p">:</span><span class="ss">:Internet</span><span class="o">.</span><span class="n">email</span>
</span><span class='line'><span class="c1">#=&gt; &quot;rosanna_smitham@vandervort.biz&quot;</span>
</span><span class='line'><span class="ss">Faker</span><span class="p">:</span><span class="ss">:Commerce</span><span class="o">.</span><span class="n">product</span>
</span><span class='line'><span class="c1">#=&gt; &quot;Intelligent Steel Computer&quot;</span>
</span><span class='line'><span class="ss">Faker</span><span class="p">:</span><span class="ss">:Business</span><span class="o">.</span><span class="n">credit_card_number</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1212-1221-1121-1234&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;</p>

<p><strong>Meryl Streep1</strong>: Yes, that&rsquo;ll be one Intelligent Steel Computer, please.  Do you accept credit
cards?<br/>
<strong>Meryl Streep2</strong>: So, this is the beginning of happiness. This is where it starts.
And, of course, there will always be more.<br/>
<strong>Meryl Streep3</strong>: Alright ladies, that&rsquo;s a wrap.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/10/bootstrapping-a-sinatra-app/">Bootstrapping a Sinatra App</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-10T12:00:09-04:00" pubdate data-updated="true">Mar 10<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sinatra is a simple open-source web framework for ruby.  It&rsquo;s similar to Rails,
but much smaller, weighing in around 1,500 lines of code compared to Rail&rsquo;s
~100,000.</p>

<p>Its stripped-down nature means that out of the box, Sinatra does less for you (automatically) than does Rails.  For example, if you tell Sinatra to <code>generate</code> a <code>scaffold</code> for you, it will respond politely that it has no idea what the [Sinatra] you&rsquo;re talking about.  What&rsquo;s more, much of the nitty-gritty of configuring you&rsquo;re environment (such as managing your environmental dependencies and database connections) is left up to you, the programmer.</p>

<p>Thus, working with Sinatra, you pay a higher setup cost upfront (than in Rails),
in exchange for a much smaller codebase, and a better understanding of how your
application does everything that it does. The following is aimed at minimizing
that cost while maximizing understanding.</p>

<p>Ready?  Here goes:</p>

<h1>1) Database/ActiveRecord</h1>

<p>This example uses Sqlite with ActiveRecord.  As mentioned, in Sinatra, you&rsquo;re in charge of establishing and managing your database connection manually.  It’s convention to put this, along with all of your other environmental dependencies in a file called <code>environment.rb</code> in your project’s <code>config/</code> directory.</p>

<h3>Gemfile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="s2">&quot;https://rubygems.org&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;sinatra&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;sqlite3&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;activerecord&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;sinatra-activerecord&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>config/environment.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Set SINATRA_ENV to development if not already set</span>
</span><span class='line'><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SINATRA_ENV&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="s2">&quot;development&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler/setup&#39;</span>
</span><span class='line'><span class="no">Bundler</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SINATRA_ENV&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span><span class="o">.</span><span class="n">establish_connection</span><span class="p">(</span>
</span><span class='line'>  <span class="ss">:adapter</span> <span class="o">=&gt;</span> <span class="s2">&quot;sqlite3&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:database</span> <span class="o">=&gt;</span> <span class="s2">&quot;db/project_</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SINATRA_ENV&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.sqlite&quot;</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, our <code>environment.rb</code> requires our bundled gems and sets our database connection conditionally based on our current environment (which we’ve stored in an environment variable).</p>

<h3>controllers/application_controller.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span>
</span><span class='line'>  <span class="n">register</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:ActiveRecordExtension</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Rakefile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;./config/environment&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra/activerecord/rake&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:db</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:down</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">FileUtils</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="s1">&#39;./db/development.sqlite&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:up</span> <span class="k">do</span>
</span><span class='line'>    <span class="ss">Rake</span><span class="p">:</span><span class="ss">:Task</span><span class="o">[</span><span class="s2">&quot;db:migrate&quot;</span><span class="o">].</span><span class="n">invoke</span>
</span><span class='line'>    <span class="ss">Rake</span><span class="p">:</span><span class="ss">:Task</span><span class="o">[</span><span class="s2">&quot;db:seed&quot;</span><span class="o">].</span><span class="n">invoke</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we’ve taken care of connecting to our database, we can think about interacting with it.  The <code>sinatra-activerecord</code> gem provides familiar database interface in the form of predefined Rake tasks like <code>rake db:migrate</code>  and <code>rake db:rollback</code>.  To use it, we include it in our Gemfile, register it in our ApplicationController, and require it in our Rakefile.</p>

<p>In addition to the tasks provided by <code>sinatra-activerecord</code>, I wrote two custom rake tasks — one for deleting the entire database, and one for migrating and re-seeding it.</p>

<h3>config.ru</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">if</span> <span class="n">defined?</span><span class="p">(</span><span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migrator</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migrator</span><span class="o">.</span><span class="n">needs_migration?</span>
</span><span class='line'>  <span class="k">raise</span> <span class="s1">&#39;Migrations are pending run `rake db:migrate` to resolve the issue.&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>spec/spec_helper.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SINATRA_ENV&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migrator</span><span class="o">.</span><span class="n">needs_migration?</span>
</span><span class='line'>  <span class="k">raise</span> <span class="s1">&#39;Migrations are pending. Run `rake db:migrate SINATRA_ENV=test` to resolve the issue.&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we raise helpful reminders in <code>config.ru</code> and our <code>spec_helper.rb</code> if either gets run when there are still pending migrations.</p>

<h1>2) Console, Local Server</h1>

<h3>Gemfile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;pry&quot;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;shotgun&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Rakefile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">task</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">require</span> <span class="s1">&#39;./config/environment&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">task</span> <span class="ss">:console</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>  <span class="no">Pry</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In addition to managing our database conneciton, we’ll have to roll own console and server tasks in Sinatra as well.  We could rackup directly from our config.ru, however, this would mean stopping and starting the development server any time we made any changes to our application.
Instead, we use a gem called shotgun, which takes care of reloading for us.  After installing type <code>shotgun</code> to fire up the server.</p>

<p>Pry provides a feature-rich debugging shell.  To use it as our console we simply define a rake task that requires our environment and starts Pry.</p>

<h1>3) MVC Structure</h1>

<p>Sinatra lets you place your model and controller code side-by-side in a general application file.   (It  will look for views in a top-level <code>views/</code> directory by default.) This may be a good option for you, depending on the size and complexity of your project.  However, if your requirements necessitate breaking your application up into a more Railsy MVC structure, here’s how to do it.</p>

<hr />

<h3>controllers/application_controller.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>(1) Define an application controller that inherits from <code>Sinatra::Base</code>.<br/>
(2) Mount it as middlewear in <code>config.ru</code>.<br/>
(3) Define individual resource controllers that inherit from <code>ApplicationController</code>.<br/>
(4) Mount them as middle-wear on top of <code>ApplicationController</code>.</p>

<h3>config.ru</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">use</span> <span class="no">UsersController</span>
</span><span class='line'><span class="n">use</span> <span class="no">OutfitsController</span>
</span><span class='line'><span class="n">use</span> <span class="no">ArticlesController</span>
</span><span class='line'><span class="n">run</span> <span class="no">ApplicationController</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>(5) Move your views to <code>app/views</code>.<br/>
(6) Move your models to <code>app/models</code>.</p>

<h3>app/controllers/application_controller.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:views</span><span class="p">,</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;../views/&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:method_override</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:sessions</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>(7) Tell Sinatra about the new location of your views.<br/>
(8) Turn on method_override if you want to use RESTful HTTP verbs via the hidden input hack.<br/>
(9) Turn on sessions if you plan to use them.</p>

<hr />

<h3>config.ru</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">use</span> <span class="ss">Rack</span><span class="p">:</span><span class="ss">:Static</span><span class="p">,</span> <span class="ss">:root</span> <span class="o">=&gt;</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="ss">:urls</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;/images&quot;</span><span class="p">,</span><span class="s2">&quot;/javascripts&quot;</span><span class="p">,</span><span class="s2">&quot;/stylesheets&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>(10) Tell Sinatra about the new location of your static resources.</p>

<hr />

<h3>Gemfile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;require_all&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>config/environment.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">require_all</span> <span class="s1">&#39;app&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that our application code is split across many files within or <code>app/</code> directory, it’d be nice to have a way to require all of those files in one fell swoop.  Luckily, that’s exactly what the <code>require_all</code> gem lets us do.  Just include it your <code>Gemfile</code> and <code>require_all</code> your application directory (conventionally ‘app’) in your <code>environment.rb</code>.</p>

<h1>4) Testing</h1>

<h3>Gemfile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;database_cleaner&#39;</span><span class="p">,</span> <span class="ss">git</span><span class="p">:</span> <span class="s1">&#39;https://github.com/bmabey/database_cleaner.git&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;rspec&quot;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;rack-test&quot;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s2">&quot;pry&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To get up and running with testing we’ll put <code>rspec</code> and a few other gems in our gemfile.  After <code>bundling</code> and running <code>rspec --init</code>, open your <code>spec_helper</code> and include Rack::Test::Methods in the configuration block to get access to rack::test stub methods.</p>

<p>E.g.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span> <span class="err">‘</span><span class="o">/</span><span class="n">students</span><span class="err">’</span><span class="p">,</span> <span class="p">{</span> <span class="err">“</span><span class="nb">name</span><span class="err">”</span> <span class="o">=&gt;</span> <span class="err">“</span><span class="no">Michael</span><span class="err">”</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> in your controller specs.</p>

<h3>spec/spec_helper.rb</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">require_relative</span> <span class="s1">&#39;../config/environment&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">include</span> <span class="ss">Rack</span><span class="p">:</span><span class="ss">:Test</span><span class="o">::</span><span class="no">Methods</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="ss">:truncation</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">clean</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Another useful tool is the DatabaseCleaner, which resets your database between examples in your tests to ensure your tests are database-independent.</p>

<p>Phew.  So there you have it &mdash; a basic bootstrap for a MVC app in Sinatra.  Enjoy, and don’t spend it all in one place.  ;)</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  <style>
<style>
  .ig-b- { display: inline-block; }
  .ig-b- img { visibility: hidden; }
  .ig-b-:hover { background-position: 0 -60px; } .ig-b-:active { background-position: 0 -120px; }
  .ig-b-16 { width: 16px; height: 16px; background: url(//badges.instagram.com/static/images/ig-badge-sprite-16.png) no-repeat 0 0; }
  @media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min&#8211;moz-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2 / 1), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx) {
  .ig-b-16 { background-image: url(//badges.instagram.com/static/images/ig-badge-sprite-16@2x.png); background-size: 60px 178px; } }
  .gravatar p { margin:0px }
  .gravatar > .text, .image { float:left }
  .gravatar .name { font-weight:bold;margin-top:4px; }
  .gravatar .text { margin-left:5px; }
  .badge { display:block;margin-bottom:3px; }
  .clearfix { display:block;clear:both;visibility:hidden; }
</style>
<section>
	<span class="gravatar">
		<img class="image" src="http://www.gravatar.com/avatar/c0181972be1b5d6dce3cbea1a0fa99d8" alt="Gravatar of Michael Prouty " title="Gravatar of Michael Prouty" />
    <span class="text">
      <p class="name">Michael Prouty</p>
      <a href="http://instagram.com/_mprouts?ref=badge" class="ig-b- ig-b-16 badge"><img src="//badges.instagram.com/static/images/ig-badge-16.png" alt="Instagram" /></a><p></p>
      <p>Ruby Developer</p>
      <p><a href="http://logcheck.com" target="_blank">LogCheck</a></p>
    </span>
    <span class="clearfix">.</span>
	</span>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/15/addressing-ip/">Addressing IP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/20/check-for-stray-binding-dot-prys-before-commit/">Check for Stray Pry Calls Before Commit</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/01/cross-domain-post-and-delete-with-jquery-and-rails/">Cross-Domain Requests With Angular & Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/18/hello-bower/">Hello, Bower</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/04/how-to-use-homebrews-version-of-git/">How to Use Homebrew&#8217;s Version of Git</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Michael Prouty -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. Design by <a href="http://octopressthemes.com">Octopress Themes</a>.</span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
